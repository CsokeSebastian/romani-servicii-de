{% extends "base.html" %}

{# =========================
   SEO â€“ HEAD BLOCKS
   ========================= #}

{% block title %}
{{ listing.name }} â€“ {{ listing.category.name if listing.category else 'Servicii' }} Ã®n {{ listing.city.name if listing.city else 'Germania' }} | Servicii RO ðŸ‡©ðŸ‡ª
{% endblock title %}

{% block meta_description %}
{{ (listing.description or ((listing.category.name if listing.category else 'Servicii') ~ " Ã®n " ~ (listing.city.name if listing.city else 'Germania') ~ ". Contact direct."))[:155] | trim }}
{% endblock meta_description %}

{% block canonical %}
{{ url_for('public.listing_page', slug=listing.slug, _external=True) | replace('http://','https://') }}
{% endblock canonical %}

{% block og_title %}
{{ listing.name }} â€“ {{ listing.city.name if listing.city else 'Germania' }}
{% endblock og_title %}

{% block og_description %}
{{ (listing.description or ((listing.category.name if listing.category else 'Servicii') ~ " Ã®n " ~ (listing.city.name if listing.city else 'Germania') ~ "."))[:155] | trim }}
{% endblock og_description %}

{% block twitter_title %}
{{ listing.name }} â€“ {{ listing.city.name if listing.city else 'Germania' }}
{% endblock twitter_title %}

{% block twitter_description %}
{{ (listing.description or ((listing.category.name if listing.category else 'Servicii') ~ " Ã®n " ~ (listing.city.name if listing.city else 'Germania') ~ "."))[:155] | trim }}
{% endblock twitter_description %}

{# =========================
   PAGE CONTENT
   ========================= #}

{% block content %}

<div class="profile">

  <div class="profile-media">
    {% if listing.image_url %}
      <img
        src="{{ listing.image_url }}"
        alt="{{ listing.name }} â€“ {{ (listing.category.name if listing.category else 'Servicii') }} Ã®n {{ (listing.city.name if listing.city else 'Germania') }}"
        loading="lazy"
      />
    {% else %}
      <div class="placeholder big">{{ listing.name[:1] }}</div>
    {% endif %}
  </div>

  <div class="profile-body">

    <h1>{{ listing.name }}</h1>

    <div class="muted">
      {{ listing.category.name if listing.category else '' }}
      {% if listing.category and listing.city %} â€¢ {% endif %}
      {{ listing.city.name if listing.city else '' }}
    </div>

    <div class="badges">
      {% if listing.featured %}<span class="badge blue">Featured</span>{% endif %}
      {% if listing.verified %}<span class="badge">Verificat</span>{% endif %}
    </div>

    {% if listing.description %}
      <p class="desc">{{ listing.description }}</p>
    {% endif %}

    <div class="contact">
      {% if listing.phone %}<div><strong>Telefon:</strong> {{ listing.phone }}</div>{% endif %}
      {% if listing.whatsapp %}<div><strong>WhatsApp:</strong> {{ listing.whatsapp }}</div>{% endif %}

      {% if listing.website %}
        <div>
          <strong>Website:</strong>
          <a href="{{ listing.website }}" target="_blank" rel="noopener nofollow">
            {{ listing.website }}
          </a>
        </div>
      {% endif %}

      {% if listing.address %}<div><strong>AdresÄƒ:</strong> {{ listing.address }}</div>{% endif %}
    </div>

    {# Schema.org â€“ LocalBusiness (SAFE) #}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": {{ listing.name|tojson }},
      "url": {{ (url_for('public.listing_page', slug=listing.slug, _external=True) | replace('http://','https://'))|tojson }},
      "image": {{ (listing.image_url or "")|tojson }},
      "telephone": {{ (listing.phone or listing.whatsapp or "")|tojson }},
      "address": {
        "@type": "PostalAddress",
        "addressLocality": {{ ((listing.city.name if listing.city else "") )|tojson }},
        "streetAddress": {{ (listing.address or "")|tojson }},
        "addressCountry": "DE"
      }
    }
    </script>

  </div>
</div>

{% endblock content %}
