{% extends "base.html" %}
{% block body_class %}footer-fixed{% endblock %}
{% block title %}Servicii pentru Români în Germania{% endblock %}

{% block content %}

  <section class="hero">
    <h1>Găsește servicii oferite de români sau în limba română, în Germania.</h1>
    <p>Liste verificate + căutare rapidă. Fără haos în grupuri.</p>

    <form class="search" method="get" action="{{ url_for('public.home') }}">
      <!-- text search -->
      <input
        name="q"
        placeholder="Caută (ex: dentist, avocat, contabil)"
        value="{{ q }}"
      />

      <!-- category -->
      <select name="category">
        <option value="">Toate categoriile</option>
        {% for c in all_categories %}
          <option value="{{ c.slug }}" {% if c.slug == category_slug %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>

      <!-- location (manual, NO GPS) -->
      <input
        type="text"
        name="location"
        placeholder="Unde te afli? (ex: Dortmund)"
        value="{{ location or '' }}"
      />

      <!-- radius -->
      <select name="radius">
        <option value="">Rază (opțional)</option>
        {% for r in ['10','20','50'] %}
          <option value="{{ r }}" {% if radius_km == r %}selected{% endif %}>
            {{ r }} km
          </option>
        {% endfor %}
      </select>

      <button type="submit">Caută</button>
    </form>
  </section>

  {% if featured %}
  <section>
    <h2>Recomandate (Featured)</h2>
    <div class="grid">
      {% for item in featured %}
        <a class="card" href="{{ url_for('public.listing_page', slug=item.slug) }}">
          <div class="card-media">
            {% if item.image_url %}
              <img src="{{ item.image_url }}" alt="{{ item.name }}"/>
            {% else %}
              <div class="placeholder">{{ item.name[:1] }}</div>
            {% endif %}
          </div>
          <div class="card-body">
            <div class="row">
              <strong>{{ item.name }}</strong>
              {% if item.verified %}<span class="badge">Verificat</span>{% endif %}
            </div>
            <div class="muted">{{ item.category.name }} • {{ item.city.name }}</div>
          </div>
        </a>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <section>
    <h2>Rezultate</h2>
    <div class="list">
      {% for item in listings %}
        <div class="list-item">
          <div class="avatar">
            {% if item.image_url %}
              <img src="{{ item.image_url }}" alt="{{ item.name }}"/>
            {% else %}
              <div class="placeholder">{{ item.name[:1] }}</div>
            {% endif %}
          </div>
          <div class="li-body">
            <a class="li-title" href="{{ url_for('public.listing_page', slug=item.slug) }}">
              {{ item.name }}
            </a>
            <div class="muted">{{ item.category.name }} • {{ item.city.name }}</div>
            <div class="badges">
              {% if item.featured %}<span class="badge blue">Featured</span>{% endif %}
              {% if item.verified %}<span class="badge">Verificat</span>{% endif %}
              {% set langs = languages_from_str(item.languages) %}
              {% if langs %}
                <span class="chip">
                  RO{% if 'de' in langs %}, DE{% endif %}{% if 'en' in langs %}, EN{% endif %}
                </span>
              {% endif %}
            </div>
          </div>
        </div>
      {% else %}
        <p class="muted">Niciun rezultat.</p>
      {% endfor %}
    </div>
  </section>
{% endblock %}
